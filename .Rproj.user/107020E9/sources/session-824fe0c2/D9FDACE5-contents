# Analisis de variables #
# Francisca Apablaza #
# Participacion en el mercado laboral #

# En este segundo Scrip, tiene por objetivo realizar una #
# visualizacion de las variables ya recodificadas anteriormente. #

#Para esta primera entrega se espera que sean capaces de generar una tabla descriptiva
#que muestre las medidas de tendencia central de las variables utilizadas en la investigación,
#así como su contraparte de tablas de frecuencias en el caso de variables categóricas. 
#También se espera que sean capaces de elaborar dos gráficos descriptivos que permitan 
#visualizar la distribución de las principales variables de interés.

# 0. Pasos previos # ----
rm(list = ls()) #limpiar area de trabajo
options(scipen = 999) #desactivar notacion cientifica

# 1. Cargar paquetes # ----
pacman::p_load(sjlabelled, dplyr, stargazer, sjmisc, summarytools, kableExtra, sjPlot, corrplot, sessioninfo, ggplot2)

# 2. Cargar base de datos # ----
load(url("https://github.com/panchamama/Practico-1/raw/main/1.%20input/casen_rec.rdata"))
# La base de datos recodificada, esta cargada desde internet.
names(proc_base)
dim(proc_base)

# 3. Descripcion de las variables # ----

sjmisc::descr(proc_base)

sjmisc::descr(proc_base,
              show = c("label","range", "mean", "sd", "NA.prc", "n"))%>%
  kable(.,"markdown")

summarytools::dfSummary(proc_base, plain.ascii = FALSE)
view(dfSummary(proc_base, headings=FALSE)) # Visualizar mejor

# 4. Seleccion de variables para el analisis # ----
names(proc_base)
casen1 <- proc_base %>% select(edad, # Edad
                               sexo, # Sexo
                               trabajo, # Trabajo formalmente 
                               trabajo_informal, # Trabajo informal
                               busqueda_trabajo, # Razon por la cual no busco trabajo
                               horas_trabajo, # Horas trabajadas
                               sueldo, # Sueldo mendual
                               nacionalidad, # Pais de nacionalidad
                               pueblo_originario) # Pertenece a algun pueblo indigena

# 5. Casos perdidos # *PENDIENTE* ---- 
casen1_original <-casen1 # Respaldamos la base recodificada original
dim(casen1) # Confirmamos los casos
sum(is.na(casen1)) #Vemos los casos perdidos
casen1 <-na.omit(casen1) # Borramos los casos perdidos
dim(casen1)
casen1 <-sjlabelled::copy_labels(casen1,casen1_original) # Recuperamos las lineas eliminadas

# 6. Visualizacion de las variables # ----
names(casen1)

## Participacion de trabajos formales ##
## Participacion de trabajos informales ##

## Empedimento para buscar trabajo ##
proc_data %>% ggplot(aes(x = conf_inst)) + 
  geom_bar(fill = "coral")+
  labs(title = "Confianza en instituciones",
       x = "Confianza en instituciones",
       y = "Frecuencia")

## Horas trabajadas ##
## Ingreso de sueldo mensual ##

# Analisis de las variables  #

## 6.2 Visualizacion de variables ## ----

### Participacion en el mercado laboral ### ----
# a) Realizo trabajo, sin contar trabajo en el hogar 
sjt.xtab(proc_base$trbj, proc_base$sexo,
         show.col.prc=TRUE,
         show.summary=FALSE,
         encoding = "UTF-8"
)

# b) Realizo trabajo de manera informal
sjt.xtab(proc_base$`trbj_no formal`, proc_base$sexo,
         show.col.prc=TRUE,
         show.summary=FALSE,
         encoding = "UTF-8"
)

# c) Cuantas horas trabajo a la semana
sjt.xtab(proc_base$horas_trbj, proc_base$sexo,
         show.col.prc=TRUE,
         show.summary=FALSE,
         encoding = "UTF-8"
)

### Rol de la familia ### ----
# d) Jefe de hogar
sjt.xtab(proc_base$jefe_h, proc_base$sexo,
         show.col.prc=TRUE,
         show.summary=FALSE,
         encoding = "UTF-8"
)

# e) Conformacion de parejas dentro del hogar
sjt.xtab(proc_base$pareja, proc_base$trbj,
         show.col.prc=TRUE,
         show.summary=FALSE,
         encoding = "UTF-8"
)

# f) El padre o la madre viven en la vivienda
sjt.xtab(proc_base$mp_vivienda, proc_base$sexo,
         show.col.prc=TRUE,
         show.summary=FALSE,
         encoding = "UTF-8"
)

# g) Razon de la no busqueda de trabjao
sjt.xtab(proc_base$busqueda_trbj, proc_base$sexo,
         show.col.prc=TRUE,
         show.summary=FALSE,
         encoding = "UTF-8"
)

### Brecha salarial ### ----
# h) Salario
# Crear el gráfico usando ggplot2
sjt.xtab(proc_base$Salario, proc_base$sexo,
         show.col.prc=TRUE,
         show.summary=FALSE,
         encoding = "UTF-8"
)

graph8 <- proc_base %>% ggplot(aes(x = Salario, fill = sexo)) + 
  geom_bar() +
  xlab("Salario") +
  ylab("Cantidad") + 
  labs(fill="Sexo")+
  scale_fill_discrete(labels = c('Hombre','Mujer'))

graph8
ggsave(graph8, file="3. output/graph8.png")